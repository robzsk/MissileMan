!function t(n,e,o){function r(u,a){if(!e[u]){if(!n[u]){var c="function"==typeof require&&require;if(!a&&c)return c(u,!0);if(i)return i(u,!0);var d=new Error("Cannot find module '"+u+"'");throw d.code="MODULE_NOT_FOUND",d}var s=e[u]={exports:{}};n[u][0].call(s.exports,function(t){var e=n[u][1][t];return r(e?e:t)},s,s.exports,t,n,e,o)}return e[u].exports}for(var i="function"==typeof require&&require,u=0;u<o.length;u++)r(o[u]);return r}({1:[function(t,n,e){!function(){"use strict";var n="level.json",e=t("./scripts/overlay"),o=t("./scripts/input"),r=t("./scripts/player"),i=t("./scripts/assets"),u=t("./scripts/world"),a=t("./scripts/loop"),c=[],d=[],s=0,f=o({keys:{left:37,right:39,jump:38}}),p=o({keys:{up:38,down:40,select:13}}),l=function(t){d=t.spawnPoints,_.each(t.targets,function(t){u.addTarget(t)}),u.addBlocks(t.cells)},y=function(t){var n=function(n){$.get(t,function(t){l(t.cells?t:JSON.parse(t)),n()})},e=function(){0===c.length&&(c[s]=r({input:f,obj:d[s]})),f.reset(),_.each(c,function(t){t.reset(),u.addPlayer(t,t===c[s])})};u.clear(),a.reset(),n(e)};$(u).on("world.player.killed",function(t,i){c[s]===i&&(c[s].detatchInput(),c[s]=r({input:o({replay:f.serialize()}),obj:d[s]}),s+=1,s>=d.length&&(s=0),c[s]&&c[s].detatchInput(),c[s]=r({input:f,obj:d[s]}),setTimeout(function(){u.isComplete()?e.showTitle(p):(e.fadeFromBlack(),y(n))},1e3))}),$(e).on("title.playbutton.click",function(){e.hideTitle(),e.fadeFromBlack(),_.each(c,function(t){t.detatchInput()}),c=[],s=0,y(n)}),$(document).ready(function(){i.load(),$(i).on("assets.loaded",function(){e.fadeFromBlack(),e.showTitle(p)})}),$(a).on("loop.update",function(t,n,e){p.update(n),_.each(c,function(t){t.update(n)}),u.update(e)}),$(a).on("loop.render",function(t,n){u.render(n)})}()},{"./scripts/assets":2,"./scripts/input":3,"./scripts/loop":4,"./scripts/overlay":5,"./scripts/player":6,"./scripts/world":8}],2:[function(t,n,e){"use strict";n.exports=function(){var t={},n=function(t){var n=new THREE.BoxGeometry(1,1,1),e=new THREE.MeshBasicMaterial({color:t}),o=new THREE.Mesh(n,e);return o};return{load:function(){var n=new THREE.LoadingManager,e=new THREE.JSONLoader(n),o=function(n,o){e.load("assets/"+o+".json",function(e){t[n]=new THREE.Mesh(e,new THREE.MeshDepthMaterial)})},r=this;n.onLoad=function(){$(r).trigger("assets.loaded")},o("empty","empty"),o("solid","solid")},cubeEmpty:function(n){return t.empty.clone()},cubeSolid:function(){return t.solid.clone()},cubeTarget:function(){return n(11289666)},cubePlayer:function(){return n(96725)}}}()},{}],3:[function(t,n,e){"use strict";var o=function(t){var n=JSON.parse(t);return{update:function(t){var e=n["_"+t];e&&$(this).trigger("input.move",_.clone(e))}}},r=function(t){var n=_.mapObject(t,function(){return!1}),e=_.clone(n),o={},r=function(e,o,r){_.findKey(t,function(t,i){return t===o?(n[i]=r,e.preventDefault(),!0):void 0})};return $(document).keydown(function(t){return r(t,t.keyCode,!0)}),$(document).keyup(function(t){return r(t,t.keyCode,!1)}),{reset:function(){o={}},serialize:function(){return JSON.stringify(o)},update:function(t){_.isMatch(n,e)||(o["_"+t]=_.clone(n),$(this).trigger("input.move",_.clone(n)),_.extend(e,n))}}};n.exports=function(t){return t.replay?o(t.replay):r(t.keys)}},{}],4:[function(t,n,e){n.exports=function(){"use strict";var t,n,e=function(){var t={begin:function(){},end:function(){}};return"undefined"!=typeof Stats&&(t=new Stats,t.setMode(0),t.domElement.style.position="absolute",t.domElement.style.left="0px",t.domElement.style.top="0px",$("body").append(t.domElement)),t}(),o=function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},r=1/60,i=0,u=o(),a=0;return+function c(){for(e.begin(),n=o(),i+=Math.min(1,(n-u)/1e3);i>r;)i-=r,$(t).trigger("loop.update",[a,r]),a+=1;$(t).trigger("loop.render",i),u=n,requestAnimationFrame(c),e.end()}(),t={reset:function(){a=0}}}()},{}],5:[function(t,n,e){n.exports=function(){"use strict";var t,n,e=function(){var t=$("<div/>").css({position:"fixed",backgroundColor:"black",height:"100%",width:"100%",margin:0,padding:0});return $("body").append(t),t}(),o=function(){var n=$("<button>").css({position:"fixed",bottom:"-100px",left:"50%"}).click(function(){$(t).trigger("title.playbutton.click")}).text("Play");return $("body").append(n),n}(),r=function(n,e){e.select&&$(t).trigger("title.playbutton.click")};return t={fadeFromBlack:function(){e.css({opacity:1}),e.stop().animate({opacity:0},600)},showTitle:function(t){o.stop().animate({bottom:"100px"},600,"easeOutBack"),n=t,$(n).on("input.move",r)},hideTitle:function(){o.stop().animate({bottom:"-100px"},400,"easeInBack"),$(n).off("input.move",r)}}}()},{}],6:[function(t,n,e){"use strict";var o=9.8*6,r=15,i=60,u=.5,a=1/6,c=1500;n.exports=function(t){var n=t.obj,e={x:n.x,y:n.y,dx:0,dy:0,gravity:o,maxdx:r,maxdy:i,impulse:c,accel:r/u,friction:r/a,left:!1,right:!1,jump:!1,start:{x:n.x,y:n.y}},d=function(t,n){e.left=n.left,e.right=n.right,e.jump=n.jump};return $(t.input).on("input.move",d),e.reset=function(){e.jump=e.left=e.right=!1,e.dx=e.dy=0,e.x=e.start.x,e.y=e.start.y},e.detatchInput=function(){$(t.input).off("input.move",d)},e.update=function(n){t.input.update(n)},e}},{}],7:[function(t,n,e){var o=26;n.exports=function(t){"use strict";var n,e=new THREE.Scene,r=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,o-9,o),i=new THREE.AmbientLight(16777215),u=new THREE.WebGLRenderer;return r.position.set(0,0,o),r.updateProjectionMatrix(),e.add(r),e.add(i),u.setSize(window.innerWidth,window.innerHeight),u.setClearColor(4079166,1),$("body").append(u.domElement),n={render:function(){u.render(e,r)},add:function(t){e.add(t)},follow:function(t){r.position.set(t.x,t.y,o)},remove:function(t){e.remove(t)},clear:function(){var t=_.clone(e.children);_.each(t,function(t){e.remove(t)})}}}},{}],8:[function(t,n,e){n.exports=function(){"use strict";var n,e,o={tw:64,th:48},r=1,i=[],u=[],a=[],c=t("./assets"),d=t("./scene"),s=d($("#canvas")),f=function(t,n,e){return Math.max(n,Math.min(e,t))},p=function(t,n){return a[t+n*o.tw]},l=function(t){return o.th-t},y=function(t,n,e,o,r,i,u,a){return!(r>t+e||t>r+u||i>n+o||n>i+a)},m=function(t){_.find(u,function(e){return y(t.x,t.y,1,1,e.x,e.y,1,1)?(s.remove(t.avatar),s.remove(e.avatar),u=_.without(u,_.findWhere(u,e)),i=_.without(i,_.findWhere(i,t)),$(n).trigger("world.player.killed",t),!0):!1})},x=function(t){var n=Math.floor(t.x),e=Math.floor(t.y),o=t.x%r,i=t.y%r,u=p(n,e),a=p(n+1,e),c=p(n,e+1),d=p(n+1,e+1);t.dy>0?(c&&!u||d&&!a&&o)&&(t.y=e,t.dy=0,t.falling=!1,t.jumping=!1,i=0):t.dy<0&&(u&&!c||a&&!d&&o)&&(t.y=e+1,t.dy=0,u=c,a=d,i=0),t.dx>0?(a&&!u||d&&!c&&i)&&(t.x=n,t.dx=0):t.dx<0&&(u&&!a||c&&!d&&i)&&(t.x=n+1,t.dx=0),t.falling=!(c||o&&d)},h=function(t,n){var e=t.dx<0,o=t.dx>0,r=t.falling,i=t.friction*(r?.5:1),u=t.accel*(r?.5:1);t.ddx=0,t.ddy=t.gravity,t.left?t.ddx=t.ddx-u:e&&(t.ddx=t.ddx+i),t.right?t.ddx=t.ddx+u:o&&(t.ddx=t.ddx-i),!t.jump||t.jumping||r||(t.ddy=t.ddy-t.impulse,t.jumping=!0),t.x=t.x+n*t.dx,t.y=t.y+n*t.dy,t.dx=f(t.dx+n*t.ddx,-t.maxdx,t.maxdx),t.dy=f(t.dy+n*t.ddy,-t.maxdy,t.maxdy),(e&&t.dx>0||o&&t.dx<0)&&(t.dx=0),x(t),m(t)};return n={update:function(t){_.each(i,function(n){h(n,t)})},render:function(t){_.each(i,function(n){n.avatar.position.set(n.x+n.dx*t,l(n.y+n.dy*t),0)}),e&&s.follow(e.position),s.render()},clear:function(){i=[],u=[],a=[],s.clear()},addTarget:function(t){var n=c.cubeTarget();u.push(t),t.avatar=n,n.position.set(t.x,l(t.y),0),s.add(n)},addPlayer:function(t,n){i.push(t),t.avatar=c.cubePlayer(),s.add(t.avatar),n&&(e=t.avatar)},addBlocks:function(t){a=t;var n,e,r,i;for(e=0;e<o.th;e++)for(n=0;n<o.tw;n++)r=p(n,e),i=1===r?c.cubeSolid():c.cubeEmpty(),i.position.set(n,l(e),0),s.add(i)},isComplete:function(){return u.length<=0}}}()},{"./assets":2,"./scene":7}]},{},[1]);