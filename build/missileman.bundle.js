!function t(e,n,r){function o(a,u){if(!n[a]){if(!e[a]){var c="function"==typeof require&&require;if(!u&&c)return c(a,!0);if(i)return i(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var s=n[a]={exports:{}};e[a][0].call(s.exports,function(t){var n=e[a][1][t];return o(n?n:t)},s,s.exports,t,e,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(t,e,n){!function(){"use strict";var e="level.json",n=t("./scripts/overlay"),r=t("./scripts/input"),o=t("./scripts/player"),i=t("./scripts/assets"),a=t("./scripts/world"),u=t("./scripts/loop"),c=[],d=[],s=0,p=r({keys:{left:37,right:39,jump:38}}),f=r({keys:{up:38,down:40,select:13}}),l=function(t){var e,n,r=t.layers[0].data,o=t.layers[1].objects;for(d=[],e=0;e<o.length;e++)n=o[e],"player"===n.type?d.push(n):"target"===n.type&&a.addTarget({x:n.x,y:n.y});a.addBlocks(r)},y=function(t){var e=function(e){$.get(t,function(t){l(t.layers?t:JSON.parse(t)),e()})},n=function(){0===c.length&&(c[s]=o({input:p,obj:d[s]})),p.reset(),_.each(c,function(t){t.reset(),a.addPlayer(t,t===c[s])})};a.clear(),u.reset(),e(n)};$(a).on("world.player.killed",function(t,i){c[s]===i&&(c[s].detatchInput(),c[s]=o({input:r({replay:p.serialize()}),obj:d[s]}),s+=1,s>=d.length&&(s=0),c[s]&&c[s].detatchInput(),c[s]=o({input:p,obj:d[s]}),setTimeout(function(){a.complete()?n.showTitle(f):(n.fadeFromBlack(),y(e))},1e3))}),$(n).on("title.playbutton.click",function(){n.hideTitle(),n.fadeFromBlack(),_.each(c,function(t){t.detatchInput()}),c=[],s=0,y(e)}),$(document).ready(function(){i.load(),$(i).on("assets.loaded",function(){n.fadeFromBlack(),n.showTitle(f)})}),$(u).on("loop.update",function(t,e,n){f.update(e),_.each(c,function(t){t.update(e)}),a.update(n)}),$(u).on("loop.render",function(t,e){a.render(e)})}()},{"./scripts/assets":2,"./scripts/input":3,"./scripts/loop":4,"./scripts/overlay":5,"./scripts/player":6,"./scripts/world":8}],2:[function(t,e,n){"use strict";e.exports=function(){var t={},e=function(t){var e=new THREE.BoxGeometry(1,1,1),n=new THREE.MeshBasicMaterial({color:t}),r=new THREE.Mesh(e,n);return r};return{load:function(){var e=new THREE.LoadingManager,n=new THREE.JSONLoader(e),r=function(e,r){n.load("assets/"+r+".json",function(n){t[e]=new THREE.Mesh(n,new THREE.MeshDepthMaterial)})},o=this;e.onLoad=function(){$(o).trigger("assets.loaded")},r("empty","empty"),r("solid","solid")},cubeEmpty:function(e){return t.empty.clone()},cubeSolid:function(){return t.solid.clone()},cubeTarget:function(){return e(11289666)},cubePlayer:function(){return e(96725)}}}()},{}],3:[function(t,e,n){"use strict";var r=function(t){var e=JSON.parse(t);return{update:function(t){var n=e["_"+t];n&&$(this).trigger("input.move",_.clone(n))}}},o=function(t){var e=_.mapObject(t,function(){return!1}),n=_.clone(e),r={},o=function(n,r,o){_.findKey(t,function(t,i){return t===r?(e[i]=o,n.preventDefault(),!0):void 0})};return $(document).keydown(function(t){return o(t,t.keyCode,!0)}),$(document).keyup(function(t){return o(t,t.keyCode,!1)}),{reset:function(){r={}},serialize:function(){return JSON.stringify(r)},update:function(t){_.isMatch(e,n)||(r["_"+t]=_.clone(e),$(this).trigger("input.move",_.clone(e)),_.extend(n,e))}}};e.exports=function(t){return t.replay?r(t.replay):o(t.keys)}},{}],4:[function(t,e,n){e.exports=function(){"use strict";var t,e,n=function(){var t={begin:function(){},end:function(){}};return"undefined"!=typeof Stats&&(t=new Stats,t.setMode(0),t.domElement.style.position="absolute",t.domElement.style.left="0px",t.domElement.style.top="0px",$("body").append(t.domElement)),t}(),r=function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},o=1/60,i=0,a=r(),u=0;return+function c(){for(n.begin(),e=r(),i+=Math.min(1,(e-a)/1e3);i>o;)i-=o,$(t).trigger("loop.update",[u,o]),u+=1;$(t).trigger("loop.render",i),a=e,requestAnimationFrame(c),n.end()}(),t={reset:function(){u=0}}}()},{}],5:[function(t,e,n){e.exports=function(){"use strict";var t,e,n=function(){var t=$("<div/>").css({position:"fixed",backgroundColor:"black",height:"100%",width:"100%",margin:0,padding:0});return $("body").append(t),t}(),r=function(){var e=$("<button>").css({position:"fixed",bottom:"-100px",left:"50%"}).click(function(){$(t).trigger("title.playbutton.click")}).text("Play");return $("body").append(e),e}(),o=function(e,n){n.select&&$(t).trigger("title.playbutton.click")};return t={fadeFromBlack:function(){n.css({opacity:1}),n.stop().animate({opacity:0},600)},showTitle:function(t){r.stop().animate({bottom:"100px"},600,"easeOutBack"),e=t,$(e).on("input.move",o)},hideTitle:function(){r.stop().animate({bottom:"-100px"},400,"easeInBack"),$(e).off("input.move",o)}}}()},{}],6:[function(t,e,n){"use strict";var r=1,o=9.8*6,i=15,a=60,u=.5,c=1/6,d=1500;e.exports=function(t){var e=t.obj,n={};n.x=e.x,n.y=e.y,n.dx=0,n.dy=0,n.gravity=r*(e.properties.gravity||o),n.maxdx=r*(e.properties.maxdx||i),n.maxdy=r*(e.properties.maxdy||a),n.impulse=r*(e.properties.impulse||d),n.accel=n.maxdx/(e.properties.accel||u),n.friction=n.maxdx/(e.properties.friction||c),n.player="player"==e.type,n.left=e.properties.left,n.right=e.properties.right,n.jump=!1,n.start={x:e.x,y:e.y};var s=function(t,e){n.left=e.left,n.right=e.right,n.jump=e.jump};return $(t.input).on("input.move",s),n.reset=function(){n.jump=n.left=n.right=!1,n.dx=n.dy=0,n.x=n.start.x,n.y=n.start.y},n.detatchInput=function(){$(t.input).off("input.move",s)},n.update=function(e){t.input.update(e)},n}},{}],7:[function(t,e,n){var r=26;e.exports=function(t){"use strict";var e,n=new THREE.Scene,o=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,r-9,r),i=new THREE.AmbientLight(16777215),a=new THREE.WebGLRenderer;return o.position.set(0,0,r),o.updateProjectionMatrix(),n.add(o),n.add(i),a.setSize(window.innerWidth,window.innerHeight),a.setClearColor(4079166,1),$("body").append(a.domElement),e={render:function(){a.render(n,o)},add:function(t){n.add(t)},follow:function(t){o.position.set(t.x,t.y,r)},remove:function(t){n.remove(t)},clear:function(){var t=_.clone(n.children);_.each(t,function(t){n.remove(t)})}}}},{}],8:[function(t,e,n){e.exports=function(){"use strict";var e,n,r={tw:64,th:48},o=1,i=[],a=[],u=[],c=t("./assets"),d=t("./scene"),s=d($("#canvas")),p=function(t,e,n){return Math.max(e,Math.min(n,t))},f=function(t,e){return u[t+e*r.tw]},l=function(t){return r.th-t},y=function(t,e,n,r,o,i,a,u){return!(o>t+n||t>o+a||i>e+r||e>i+u)},x=function(t){_.find(a,function(n){return y(t.x,t.y,1,1,n.x,n.y,1,1)?(s.remove(t.avatar),s.remove(n.avatar),a=_.without(a,_.findWhere(a,n)),i=_.without(i,_.findWhere(i,t)),$(e).trigger("world.player.killed",t),!0):!1})},m=function(t){var e=Math.floor(t.x),n=Math.floor(t.y),r=t.x%o,i=t.y%o,a=f(e,n),u=f(e+1,n),c=f(e,n+1),d=f(e+1,n+1);t.dy>0?(c&&!a||d&&!u&&r)&&(t.y=n,t.dy=0,t.falling=!1,t.jumping=!1,i=0):t.dy<0&&(a&&!c||u&&!d&&r)&&(t.y=n+1,t.dy=0,a=c,u=d,i=0),t.dx>0?(u&&!a||d&&!c&&i)&&(t.x=e,t.dx=0):t.dx<0&&(a&&!u||c&&!d&&i)&&(t.x=e+1,t.dx=0),t.falling=!(c||r&&d)},h=function(t,e){var n=t.dx<0,r=t.dx>0,o=t.falling,i=t.friction*(o?.5:1),a=t.accel*(o?.5:1);t.ddx=0,t.ddy=t.gravity,t.left?t.ddx=t.ddx-a:n&&(t.ddx=t.ddx+i),t.right?t.ddx=t.ddx+a:r&&(t.ddx=t.ddx-i),!t.jump||t.jumping||o||(t.ddy=t.ddy-t.impulse,t.jumping=!0),t.x=t.x+e*t.dx,t.y=t.y+e*t.dy,t.dx=p(t.dx+e*t.ddx,-t.maxdx,t.maxdx),t.dy=p(t.dy+e*t.ddy,-t.maxdy,t.maxdy),(n&&t.dx>0||r&&t.dx<0)&&(t.dx=0),m(t),x(t)};return e={update:function(t){_.each(i,function(e){h(e,t)})},render:function(t){_.each(i,function(e){e.avatar.position.set(e.x+e.dx*t,l(e.y+e.dy*t),0)}),n&&s.follow(n.position),s.render()},clear:function(){i=[],a=[],u=[],s.clear()},addTarget:function(t){var e=c.cubeTarget();a.push(t),t.avatar=e,e.position.set(t.x,l(t.y),0),s.add(e)},addPlayer:function(t,e){i.push(t),t.avatar=c.cubePlayer(),s.add(t.avatar),e&&(n=t.avatar)},addBlocks:function(t){u=t;var e,n,o,i;for(n=0;n<r.th;n++)for(e=0;e<r.tw;e++)o=f(e,n),i=1===o?c.cubeSolid():c.cubeEmpty(),i.position.set(e,l(n),0),s.add(i)},complete:function(){return a.length<=0}}}()},{"./assets":2,"./scene":7}]},{},[1]);