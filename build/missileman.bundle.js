!function t(n,e,o){function r(a,c){if(!e[a]){if(!n[a]){var u="function"==typeof require&&require;if(!c&&u)return u(a,!0);if(i)return i(a,!0);var s=new Error("Cannot find module '"+a+"'");throw s.code="MODULE_NOT_FOUND",s}var l=e[a]={exports:{}};n[a][0].call(l.exports,function(t){var e=n[a][1][t];return r(e?e:t)},l,l.exports,t,n,e,o)}return e[a].exports}for(var i="function"==typeof require&&require,a=0;a<o.length;a++)r(o[a]);return r}({1:[function(t,n,e){!function(){"use strict";var n="level.json",e=t("./src/overlay"),o=t("./src/input"),r=t("./src/player"),i=t("./src/assets"),a=t("./src/world"),c=t("./src/loop"),u=[],s=[],l=0,f=o({keys:{left:37,right:39,jump:38}}),p=o({keys:{up:38,down:40,select:13}}),d=function(t){s=t.spawnPoints,_.each(t.targets,function(t){a.addTarget(t)}),a.addBlocks(t.cells)},y=function(t){var n=function(n){$.get(t,function(t){d(t.cells?t:JSON.parse(t)),n()})},e=function(){0===u.length&&(u[l]=r({input:f,pos:s[l]})),f.reset(),_.each(u,function(t){t.reset(),a.addPlayer(t,t===u[l])})};a.clear(),c.reset(),n(e)};$(a).on("world.player.killed",function(t,i){u[l]===i&&(u[l].detatchInput(),u[l]=r({input:o({replay:f.serialize()}),obj:s[l]}),l+=1,l>=s.length&&(l=0),u[l]&&u[l].detatchInput(),u[l]=r({input:f,obj:s[l]}),setTimeout(function(){a.isComplete()?e.showTitle(p):(e.fadeFromBlack(),y(n))},1e3))}),$(e).on("title.playbutton.click",function(){e.hideTitle(),e.fadeFromBlack(),_.each(u,function(t){t.detatchInput()}),u=[],l=0,y(n)}),$(document).ready(function(){i.load(),$(i).on("assets.loaded",function(){e.fadeFromBlack(),e.showTitle(p)})}),$(c).on("loop.update",function(t,n,e){p.update(n),a.update(n,e)}),$(c).on("loop.render",function(t,n){a.render(n)})}()},{"./src/assets":2,"./src/input":3,"./src/loop":4,"./src/overlay":5,"./src/player":10,"./src/world":12}],2:[function(t,n,e){"use strict";n.exports=function(){var t={},n=function(t){var n=new THREE.BoxGeometry(1,1,1),e=new THREE.MeshBasicMaterial({color:t}),o=new THREE.Mesh(n,e);return o};return{load:function(){var n=new THREE.LoadingManager,e=new THREE.JSONLoader(n),o=function(n,o,r){e.load("assets/"+o+".json",function(e){t[n]=new THREE.Mesh(e,void 0===r?new THREE.MeshDepthMaterial:new THREE.MeshBasicMaterial({color:r}))})},r=this;n.onLoad=function(){$(r).trigger("assets.loaded")},o("empty","empty"),o("solid","solid"),o("player","player",96725)},cubeEmpty:function(n){return t.empty.clone()},cubeSolid:function(){return t.solid.clone()},cubeTarget:function(){return n(11289666)},cubePlayer:function(){return t.player.clone()}}}()},{}],3:[function(t,n,e){"use strict";var o=function(t){var n=JSON.parse(t);return{update:function(t){var e=n["_"+t];e&&$(this).trigger("input.move",_.clone(e))}}},r=function(t){var n=_.mapObject(t,function(){return!1}),e=_.clone(n),o={},r=function(e,o,r){_.findKey(t,function(t,i){return t===o?(n[i]=r,e.preventDefault(),!0):void 0})};return $(document).keydown(function(t){return r(t,t.keyCode,!0)}),$(document).keyup(function(t){return r(t,t.keyCode,!1)}),{reset:function(){o={}},serialize:function(){return JSON.stringify(o)},update:function(t){_.isMatch(n,e)||(o["_"+t]=_.clone(n),$(this).trigger("input.move",_.clone(n)),_.extend(e,n))}}};n.exports=function(t){return t.replay?o(t.replay):r(t.keys)}},{}],4:[function(t,n,e){n.exports=function(){"use strict";var t,n,e=function(){var t={begin:function(){},end:function(){}};return"undefined"!=typeof Stats&&(t=new Stats,t.setMode(0),t.domElement.style.position="absolute",t.domElement.style.left="0px",t.domElement.style.top="0px",$("body").append(t.domElement)),t}(),o=function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},r=1/60,i=0,a=o(),c=0;return+function u(){for(requestAnimationFrame(u),e.begin(),n=o(),i+=Math.min(1,(n-a)/1e3);i>r;)i-=r,$(t).trigger("loop.update",[c,r]),c+=1;$(t).trigger("loop.render",i),a=n,e.end()}(),t={reset:function(){c=0}}}()},{}],5:[function(t,n,e){n.exports=function(){"use strict";var t,n,e=function(){var t=$("<div/>").css({position:"fixed",backgroundColor:"black",height:"100%",width:"100%",margin:0,padding:0});return $("body").append(t),t}(),o=function(){var n=$("<button>").css({position:"fixed",bottom:"-100px",left:"50%"}).click(function(){$(t).trigger("title.playbutton.click")}).text("Play");return $("body").append(n),n}(),r=function(n,e){e.select&&$(t).trigger("title.playbutton.click")};return t={fadeFromBlack:function(){e.css({opacity:1}),e.stop().animate({opacity:0},600)},showTitle:function(t){o.stop().animate({bottom:"100px"},600,"easeOutBack"),n=t,$(n).on("input.move",r)},hideTitle:function(){o.stop().animate({bottom:"-100px"},400,"easeInBack"),$(n).off("input.move",r)}}}()},{}],6:[function(t,n,e){var o=t("./plane"),r=function(){return{position:new THREE.Vector3(0,0,0),momentum:new THREE.Vector3(0,0,0),orientation:new THREE.Quaternion(0,0,0,1),angularMomentum:new THREE.Vector3(0,0,0),velocity:new THREE.Vector3(0,0,0),angularVelocity:new THREE.Vector3(0,0,0),spin:new THREE.Quaternion(0,0,0,1),bodyToWorld:new THREE.Matrix4,inertiaTensor:1/6,inverseInertiaTensor:6}},i=function(){return{velocity:new THREE.Vector3(0,0,0),force:new THREE.Vector3(0,0,0),spin:new THREE.Quaternion(0,0,0,1),torque:new THREE.Vector3(0,0,0)}},a=new THREE.Vector3,c=function(t,n,e,r,i){var c=i.nearestPoint(r);if(a.set(r.x-c.x,r.y-c.y,0),a.length()<r.r){var s=a.clone().normalize(),l=s.clone().multiplyScalar(r.r),f=s.clone(),p=c,d=new THREE.Vector3;d.set(r.x,r.y,0),d.sub(l),u(t,n,e,d,i,o(f,p))}},u=function(t,n,e,o,r,i){var a=1e3,c=i.constant-o.dot(i.normal);if(c>0){var u=t.angularVelocity.clone(),s=new THREE.Vector3;s.set(o.x,o.y,0).sub(t.position),u.cross(s).add(t.momentum);var l=(-i.normal.dot(u),i.normal.clone().multiplyScalar(c*a));n.add(l),e.add((new THREE.Vector3).subVectors(o,t.position).cross(l))}};n.exports=function(){"use strict";var t=r(),n=function(){t.velocity.copy(t.momentum),t.angularVelocity.copy(t.angularMomentum).multiplyScalar(t.inverseInertiaTensor),t.orientation.normalize(),t.spin.set(.5*t.angularVelocity.x,.5*t.angularVelocity.y,.5*t.angularVelocity.z,0),t.spin.multiply(t.orientation),t.bodyToWorld.makeTranslation(t.position.x,t.position.y,0),t.bodyToWorld.makeRotationFromQuaternion(t.orientation)},e=function(t,n,e){t.x+=n.x*e,t.y+=n.y*e,t.z+=n.z*e,"undefined"!=typeof t.w&&(t.w+=n.w*e)},o=function(t,n,e,o,r,i){var a=1/6;t.x+=a*i*(n.x+2*(e.x+o.x)+r.x),t.y+=a*i*(n.y+2*(e.y+o.y)+r.y),t.z+=a*i*(n.z+2*(e.z+o.z)+r.z),"undefined"!=typeof t.w&&(t.w+=a*i*(n.w+2*(e.w+o.w)+r.w))},a=new THREE.Vector3,u=function(n,e,o,r,i){_.each(i,function(i){_.each(r,function(r){a.set(r.x,r.y,0),a.transformDirection(t.bodyToWorld),a.multiply(r),a.add(t.position),a.r=r.r,c(n,e,o,a,i)})})},s=function(t,n,e,o,r){n.set(0,0,0),e.set(0,0,0),p.forces(t,n,e),u(t,n,e,o,r),p.control(t,n,e)},l=function(t,o,r,a,c){var u=i();return"undefined"!=typeof a&&(e(t.position,a.velocity,c),e(t.momentum,a.force,c),e(t.orientation,a.spin,c),e(t.angularMomentum,a.torque,c),n()),u.velocity.copy(t.velocity),u.spin.copy(t.spin),s(t,u.force,u.torque,o,r),u},f=function(t,e,r,i){var a=l(e,r,i),c=l(e,r,i,a,.5*t),u=l(e,r,i,c,.5*t),s=l(e,r,i,u,t);o(e.position,a.velocity,c.velocity,u.velocity,s.velocity,t),o(e.momentum,a.force,c.force,u.force,s.force,t),o(e.orientation,a.spin,c.spin,u.spin,s.spin,t),o(e.angularMomentum,a.torque,c.torque,u.torque,s.torque,t),p.limitMomentum(e),n()},p={update:function(n,e,o){f(n,t,e,o)},forces:function(t,n,e){},control:function(t,n,e){},limitMomentum:function(t){},setPosition:function(n,e){t.position.set(n,e,0)},get x(){return t.position.x},get y(){return t.position.y},get orientation(){return t.orientation.clone()}};return p}},{"./plane":8}],7:[function(t,n,e){var o=[];o.push([[],[{a:[2,2],b:[3,2]}],[{a:[1,2],b:[2,2]}],[{a:[1,2],b:[3,2]}],[{a:[0,2],b:[1,2]}],[{a:[0,2],b:[1,2]},{a:[2,2],b:[3,2]}],[{a:[0,2],b:[2,2]}],[{a:[0,2],b:[3,2]}]]),o.push([[],[{a:[2,1],b:[3,1]}],[{a:[1,1],b:[2,1]}],[{a:[1,1],b:[3,1]}],[{a:[0,1],b:[1,1]}],[{a:[0,1],b:[1,1]},{a:[2,1],b:[3,1]}],[{a:[0,1],b:[2,1]}],[{a:[0,1],b:[3,1]}]]),o.push([[],[{a:[1,0],b:[1,1]}],[{a:[1,1],b:[1,2]}],[{a:[1,1],b:[1,3]}],[{a:[1,0],b:[1,1]}],[{a:[1,0],b:[1,1]},{a:[1,2],b:[1,3]}],[{a:[1,0],b:[1,2]}],[{a:[1,0],b:[1,3]}]]),o.push([[],[{a:[2,0],b:[2,1]}],[{a:[2,1],b:[2,2]}],[{a:[2,1],b:[2,3]}],[{a:[2,0],b:[2,1]}],[{a:[2,0],b:[2,1]},{a:[2,2],b:[2,3]}],[{a:[2,0],b:[2,2]}],[{a:[2,0],b:[2,3]}]]);var r=new THREE.Vector3;n.exports={createLine:function(t){var n={x:t.a[0],y:t.a[1],z:0},e={x:t.b[0],y:t.b[1],z:0},o=function(){var t=new THREE.Vector3;return t.subVectors(e,n)}();return{p1:n,p2:e,nearestPoint:function(t){t.z=t.z||0;var i=r.subVectors(t,n).setZ(0).dot(o);return 0>i?n:i>o.lengthSq()?e:r.copy(o).multiplyScalar(i/o.lengthSq()).add(n).clone()}}},makeLines:function(t,n){switch(n){case"top":return o[0][t];case"bottom":return o[1][t];case"left":return o[2][t];case"right":return o[3][t]}return[]}}},{}],8:[function(t,n,e){n.exports=function(t,n){return{normal:t,constant:t.dot(n)}}},{}],9:[function(t,n,e){"use strict";var o=new THREE.Matrix3,r=new THREE.Vector3,i=function(t){var n=t.x+t.x,e=t.y+t.y,r=t.z+t.z,i=n*t.w,a=e*t.w,c=r*t.w,u=n*t.x,s=e*t.x,l=r*t.x,f=e*t.y,p=r*t.y,d=r*t.z;return o.set(1-(f+d),s-c,0,s+c,1-(u+d),0,l-a,p+i,0)};n.exports=function(t,n,e){r.copy(e),r.applyMatrix3(i(n)),t.x+=r.x,t.y+=r.y}},{}],10:[function(t,n,e){var o=.5,r=.8,i=.4,a=new THREE.Vector3(0,5,0),c=[{x:0,y:.175,r:.25},{x:0,y:-.175,r:.25}];n.exports=function(n){"use strict";var e=t("./physics/entity")(),u=t("./physics/thrust"),s=!1,l=!1,f=!1;e.forces=function(t,n,e){var o=t.angularVelocity;u(n,t.orientation,a),e.x-=o.x*i,e.y-=o.y*i,e.z-=o.z*i},e.control=function(t,n,e){s&&(e.z+=r),l&&(e.z-=r)},e.limitMomentum=function(t){var n=t.momentum;n.length()>o&&(n.normalize(),n.multiplyScalar(o))};var p=function(t,n){s=n.left,l=n.right,f=n.jump};return $(n.input).on("input.move",p),{get x(){return e.x},get y(){return e.y},get orientation(){return e.orientation},detatchInput:function(){$(n.input).off("input.move",p)},reset:function(){f=s=l=!1,e.setPosition(n.pos.x,n.pos.y)},update:function(t,o,r){n.input.update(t),e.update(o,c,r)}}}},{"./physics/entity":6,"./physics/thrust":9}],11:[function(t,n,e){var o=26;n.exports=function(t){"use strict";var n,e=new THREE.Scene,r=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,o-9,o),i=new THREE.AmbientLight(16777215),a=new THREE.WebGLRenderer;return r.position.set(0,0,o),r.updateProjectionMatrix(),e.add(r),e.add(i),a.setSize(window.innerWidth,window.innerHeight),a.setClearColor(4079166,1),$("body").append(a.domElement),n={render:function(){a.render(e,r)},add:function(t){e.add(t)},follow:function(t){r.position.set(t.x,t.y,o)},remove:function(t){e.remove(t)},clear:function(){var t=_.clone(e.children);_.each(t,function(t){e.remove(t)})}}}},{}],12:[function(t,n,e){n.exports=function(){"use strict";var n,e=t("./physics/line"),o={tw:64,th:48},r=function(t,n){return c[t+n*o.tw]},i=[],a=[],c={},u=t("./assets"),s=t("./scene"),l=s($("#canvas"));return{update:function(t,n){_.each(i,function(o){var i=Math.floor(o.x),a=Math.floor(o.y),c=0;c+=r(i-1,a-1)?4:0,c+=r(i,a-1)?2:0,c+=r(i-1,a-1)?1:0;var u=(e.makeLines(c,"bottom"),[]);u.push(e.createLine({a:[1,1],b:[4,1]})),o.update(t,n,u)})},render:function(t){_.each(i,function(t){var n,e={},o=t.orientation,r=o.x*o.x+o.y*o.y+o.z*o.z;if(r>0){n=2*Math.acos(o.w);var i=1/Math.sqrt(r);e.x=t.x*i,e.y=t.y*i,e.z=t.z*i}else n=0,e.x=1,e.y=0,e.z=0;var a=new THREE.Quaternion;a.setFromAxisAngle(e,n),t.avatar.setRotationFromQuaternion(t.orientation),t.avatar.position.set(t.x,t.y,0),t.avatar.matrixAutoUpdate=!1,t.avatar.updateMatrix()}),n&&l.follow(n.position),l.render()},clear:function(){i=[],a=[],c=[],l.clear()},addTarget:function(t){var n=u.cubeTarget();a.push(t),t.avatar=n,n.position.set(t.x,t.y,0),l.add(n)},addPlayer:function(t,e){i.push(t),t.avatar=u.cubePlayer(),l.add(t.avatar),e&&(n=t.avatar)},addBlocks:function(t){c=t;var n,e,i,a;for(e=o.th-1;e>=0;e--)for(n=0;n<o.tw;n++)i=r(n,e),a=1===i?u.cubeSolid():u.cubeEmpty(),a.position.set(n,e,0),l.add(a)},isComplete:function(){return a.length<=0}}}()},{"./assets":2,"./physics/line":7,"./scene":11}]},{},[1]);