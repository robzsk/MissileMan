!function t(e,n,r){function o(a,u){if(!n[a]){if(!e[a]){var d="function"==typeof require&&require;if(!u&&d)return d(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var s=n[a]={exports:{}};e[a][0].call(s.exports,function(t){var n=e[a][1][t];return o(n?n:t)},s,s.exports,t,e,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(t,e,n){!function(){"use strict";var e="level.json",n=t("./scripts/overlay"),r=t("./scripts/input"),o=t("./scripts/player"),i=t("./scripts/assets"),a=t("./scripts/world"),u=t("./scripts/loop");n.fadeFromBlack(),n.showTitle();var d,c,s=r({keys:{left:37,right:39,jump:38}}),p=[],f=function(t){var e,n,r=t.layers[0].data,i=t.layers[1].objects;for(e=0;e<i.length;e++)n=i[e],"player"===n.type?(c=n,d=o({input:s,obj:n}),a.addPlayer(d)):"target"===n.type&&a.addTarget({x:n.x,y:n.y});a.addBlocks(r)},l=function(t){var e=function(e){$.get(t,function(t){f(t.layers?t:JSON.parse(t)),e()})},n=function(){_.each(p,function(t){a.addPlayer(o({input:t,obj:c}))})};a.clear(),u.reset(),e(n)};$(a).on("world.player.killed",function(t,o){d===o&&(p.push(r({replay:s.serialize()})),setTimeout(function(){a.isComplete()&&(p=[],n.showTitle()),s.reset(),l(e),n.fadeFromBlack()},1e3))}),$(n).on("title.playbutton.click",function(){n.hideTitle(),n.fadeFromBlack(),l(e)}),$(document).ready(function(){i.load(),$(i).on("assets.loaded",function(){l(e)})}),$(u).on("loop.update",function(t,e,n){s.update(e),_.each(p,function(t){t.update(e)}),a.update(n)}),$(u).on("loop.render",function(t,e){a.render(e)})}()},{"./scripts/assets":2,"./scripts/input":3,"./scripts/loop":4,"./scripts/overlay":5,"./scripts/player":6,"./scripts/world":8}],2:[function(t,e,n){"use strict";e.exports=function(){var t={},e=function(t){var e=new THREE.BoxGeometry(1,1,1),n=new THREE.MeshBasicMaterial({color:t}),r=new THREE.Mesh(e,n);return r};return{load:function(){var e=new THREE.LoadingManager,n=new THREE.JSONLoader(e),r=function(e,r){n.load("assets/"+r+".json",function(n){t[e]=new THREE.Mesh(n,new THREE.MeshDepthMaterial)})},o=this;e.onLoad=function(){$(o).trigger("assets.loaded")},r("empty","empty"),r("solid","solid")},cubeEmpty:function(e){return t.empty.clone()},cubeSolid:function(){return t.solid.clone()},cubeTarget:function(){return e(11289666)},cubePlayer:function(){return e(96725)}}}()},{}],3:[function(t,e,n){"use strict";var r=function(t){var e=JSON.parse(t),n={update:function(t){var r=e["_"+t];r&&$(n).trigger("input.move",r)}};return n},o=function(t){var e={},n=!1,r=!1,o=!1,i=!1,a=!1,u=!1,d=function(e,n,r){switch(n){case t.left:return i=r,e.preventDefault(),!1;case t.right:return a=r,e.preventDefault(),!1;case t.jump:return u=r,e.preventDefault(),!1}};document.addEventListener("keydown",function(t){return d(t,t.keyCode,!0)},!1),document.addEventListener("keyup",function(t){return d(t,t.keyCode,!1)},!1);var c={reset:function(){e={}},serialize:function(){return JSON.stringify(e)},update:function(t){var d;(n!==i||r!==a||o!==u)&&(d={left:i,right:a,jump:u,tick:t},e["_"+t]=d,$(c).trigger("input.move",d),n=i,r=a,o=u)}};return c};e.exports=function(t){return t.replay?r(t.replay):o(t.keys)}},{}],4:[function(t,e,n){e.exports=function(){"use strict";var t,e,n=function(){var t={begin:function(){},end:function(){}};return"undefined"!=typeof Stats&&(t=new Stats,t.setMode(0),t.domElement.style.position="absolute",t.domElement.style.left="0px",t.domElement.style.top="0px",$("body").append(t.domElement)),t}(),r=function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},o=1/60,i=0,a=r(),u=0;return+function d(){for(n.begin(),e=r(),i+=Math.min(1,(e-a)/1e3);i>o;)i-=o,$(t).trigger("loop.update",[u,o]),u+=1;$(t).trigger("loop.render",i),a=e,requestAnimationFrame(d),n.end()}(),t={reset:function(){u=0}}}()},{}],5:[function(t,e,n){e.exports=function(){"use strict";var t,e=function(){var t=$("<div/>").css({position:"fixed",backgroundColor:"black",height:"100%",width:"100%",margin:0,padding:0});return $("body").append(t),t}(),n=function(){var e=$("<button>").css({position:"fixed",bottom:"-100px",left:"50%"}).click(function(){$(t).trigger("title.playbutton.click")}).text("Play");return $("body").append(e),e}();return t={fadeFromBlack:function(){e.css({opacity:1}),e.stop().animate({opacity:0},600)},showTitle:function(){n.stop().animate({bottom:"100px"},600,"easeOutBack")},hideTitle:function(){n.stop().animate({bottom:"-100px"},400,"easeInBack")}}}()},{}],6:[function(t,e,n){"use strict";var r=1,o=9.8*6,i=15,a=60,u=.5,d=1/6,c=1500;e.exports=function(t){var e=t.obj,n={};return n.x=e.x,n.y=e.y,n.dx=0,n.dy=0,n.gravity=r*(e.properties.gravity||o),n.maxdx=r*(e.properties.maxdx||i),n.maxdy=r*(e.properties.maxdy||a),n.impulse=r*(e.properties.impulse||c),n.accel=n.maxdx/(e.properties.accel||u),n.friction=n.maxdx/(e.properties.friction||d),n.player="player"==e.type,n.left=e.properties.left,n.right=e.properties.right,n.jump=!1,n.start={x:e.x,y:e.y},n.reset=function(){n.jump=n.left=n.right=!1,n.dx=n.dy=0,n.x=n.start.x,n.y=n.start.y},n.setInput=function(t){$(t).on("input.move",function(t,e){n.left=e.left,n.right=e.right,n.jump=e.jump})},t.input&&n.setInput(t.input),n}},{}],7:[function(t,e,n){var r=26;e.exports=function(t){"use strict";var e,n=new THREE.Scene,o=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,r-9,r),i=new THREE.AmbientLight(16777215),a=new THREE.WebGLRenderer;return o.position.set(0,0,r),o.updateProjectionMatrix(),n.add(o),n.add(i),a.setSize(window.innerWidth,window.innerHeight),a.setClearColor(4079166,1),$("body").append(a.domElement),e={render:function(){a.render(n,o)},add:function(t){n.add(t)},follow:function(t){o.position.set(t.x,t.y,r)},remove:function(t){n.remove(t)},clear:function(){var t=_.clone(n.children);_.each(t,function(t){n.remove(t)})}}}},{}],8:[function(t,e,n){e.exports=function(){"use strict";var e,n={tw:64,th:48},r=1,o=[],i=[],a=[],u=t("./assets"),d=t("./scene"),c=d($("#canvas")),s=function(t,e,n){return Math.max(e,Math.min(n,t))},p=function(t,e){return a[t+e*n.tw]},f=function(t){return n.th-t},l=function(t,e,n,r,o,i,a,u){return!(o>t+n||t>o+a||i>e+r||e>i+u)},y=function(t){_.find(i,function(n){return l(t.x,t.y,1,1,n.x,n.y,1,1)?(c.remove(t.avatar),c.remove(n.avatar),i=_.without(i,_.findWhere(i,n)),o=_.without(o,_.findWhere(o,t)),$(e).trigger("world.player.killed",t),!0):!1})},x=function(t){var e=Math.floor(t.x),n=Math.floor(t.y),o=t.x%r,i=t.y%r,a=p(e,n),u=p(e+1,n),d=p(e,n+1),c=p(e+1,n+1);t.dy>0?(d&&!a||c&&!u&&o)&&(t.y=n,t.dy=0,t.falling=!1,t.jumping=!1,i=0):t.dy<0&&(a&&!d||u&&!c&&o)&&(t.y=n+1,t.dy=0,a=d,u=c,i=0),t.dx>0?(u&&!a||c&&!d&&i)&&(t.x=e,t.dx=0):t.dx<0&&(a&&!u||d&&!c&&i)&&(t.x=e+1,t.dx=0),t.falling=!(d||o&&c)},m=function(t,e){var n=t.dx<0,r=t.dx>0,o=t.falling,i=t.friction*(o?.5:1),a=t.accel*(o?.5:1);t.ddx=0,t.ddy=t.gravity,t.left?t.ddx=t.ddx-a:n&&(t.ddx=t.ddx+i),t.right?t.ddx=t.ddx+a:r&&(t.ddx=t.ddx-i),!t.jump||t.jumping||o||(t.ddy=t.ddy-t.impulse,t.jumping=!0),t.x=t.x+e*t.dx,t.y=t.y+e*t.dy,t.dx=s(t.dx+e*t.ddx,-t.maxdx,t.maxdx),t.dy=s(t.dy+e*t.ddy,-t.maxdy,t.maxdy),(n&&t.dx>0||r&&t.dx<0)&&(t.dx=0),x(t),y(t)};return e={update:function(t){_.each(o,function(e){m(e,t)})},render:function(t){_.each(o,function(e){e.avatar.position.set(e.x+e.dx*t,f(e.y+e.dy*t),0)}),o[0]&&c.follow(o[0].avatar.position),c.render()},clear:function(){o=[],i=[],a=[],c.clear()},addTarget:function(t){var e=u.cubeTarget();i.push(t),t.avatar=e,e.position.set(t.x,f(t.y),0),c.add(e)},addPlayer:function(t){o.push(t),t.avatar=u.cubePlayer(),c.add(t.avatar)},addBlocks:function(t){a=t;var e,r,o,i;for(r=0;r<n.th;r++)for(e=0;e<n.tw;e++)o=p(e,r),i=1===o?u.cubeSolid():u.cubeEmpty(),i.position.set(e,f(r),0),c.add(i)},isComplete:function(){return 0===i.length}}}()},{"./assets":2,"./scene":7}]},{},[1]);