!function n(t,e,o){function r(a,c){if(!e[a]){if(!t[a]){var u="function"==typeof require&&require;if(!c&&u)return u(a,!0);if(i)return i(a,!0);var s=new Error("Cannot find module '"+a+"'");throw s.code="MODULE_NOT_FOUND",s}var l=e[a]={exports:{}};t[a][0].call(l.exports,function(n){var e=t[a][1][n];return r(e?e:n)},l,l.exports,n,t,e,o)}return e[a].exports}for(var i="function"==typeof require&&require,a=0;a<o.length;a++)r(o[a]);return r}({1:[function(n,t,e){!function(){"use strict";var t="level.json",e=n("./src/overlay"),o=n("./src/input"),r=n("./src/player"),i=n("./src/assets"),a=n("./src/world"),c=n("./src/loop"),u=[],s=[],l=0,f=o({keys:{left:37,right:39,jump:38}}),p=o({keys:{up:38,down:40,select:13}}),d=function(n){s=n.spawnPoints,_.each(n.targets,function(n){a.addTarget(n)}),a.addBlocks(n.cells)},y=function(n){var t=function(t){$.get(n,function(n){d(n.cells?n:JSON.parse(n)),t()})},e=function(){0===u.length&&(u[l]=r({input:f,pos:s[l]})),f.reset(),_.each(u,function(n){n.reset(),a.addPlayer(n,n===u[l])})};a.clear(),c.reset(),t(e)};$(a).on("world.player.killed",function(n,i){u[l]===i&&(u[l].detatchInput(),u[l]=r({input:o({replay:f.serialize()}),obj:s[l]}),l+=1,l>=s.length&&(l=0),u[l]&&u[l].detatchInput(),u[l]=r({input:f,obj:s[l]}),setTimeout(function(){a.isComplete()?e.showTitle(p):(e.fadeFromBlack(),y(t))},1e3))}),$(e).on("title.playbutton.click",function(){e.hideTitle(),e.fadeFromBlack(),_.each(u,function(n){n.detatchInput()}),u=[],l=0,y(t)}),$(document).ready(function(){i.load(),$(i).on("assets.loaded",function(){e.fadeFromBlack(),e.showTitle(p)})}),$(c).on("loop.update",function(n,t,e){p.update(t),a.update(t,e)}),$(c).on("loop.render",function(n,t){a.render(t)})}()},{"./src/assets":2,"./src/input":3,"./src/loop":4,"./src/overlay":5,"./src/player":11,"./src/world":13}],2:[function(n,t,e){"use strict";t.exports=function(){var n={},t=function(n){var t=new THREE.BoxGeometry(1,1,1),e=new THREE.MeshBasicMaterial({color:n}),o=new THREE.Mesh(t,e);return o};return{load:function(){var t=new THREE.LoadingManager,e=new THREE.JSONLoader(t),o=function(t,o,r){e.load("assets/"+o+".json",function(e){n[t]=new THREE.Mesh(e,void 0===r?new THREE.MeshDepthMaterial:new THREE.MeshBasicMaterial({color:r}))})},r=this;t.onLoad=function(){$(r).trigger("assets.loaded")},o("empty","empty"),o("solid","solid"),o("player","player",96725)},cubeEmpty:function(t){return n.empty.clone()},cubeSolid:function(){return n.solid.clone()},cubeTarget:function(){return t(11289666)},cubePlayer:function(){return n.player.clone()}}}()},{}],3:[function(n,t,e){"use strict";var o=function(n){var t=JSON.parse(n);return{update:function(n){var e=t["_"+n];e&&$(this).trigger("input.move",_.clone(e))}}},r=function(n){var t=_.mapObject(n,function(){return!1}),e=_.clone(t),o={},r=function(e,o,r){_.findKey(n,function(n,i){return n===o?(t[i]=r,e.preventDefault(),!0):void 0})};return $(document).keydown(function(n){return r(n,n.keyCode,!0)}),$(document).keyup(function(n){return r(n,n.keyCode,!1)}),{reset:function(){o={}},serialize:function(){return JSON.stringify(o)},update:function(n){_.isMatch(t,e)||(o["_"+n]=_.clone(t),$(this).trigger("input.move",_.clone(t)),_.extend(e,t))}}};t.exports=function(n){return n.replay?o(n.replay):r(n.keys)}},{}],4:[function(n,t,e){t.exports=function(){"use strict";var n,t,e=function(){var n={begin:function(){},end:function(){}};return"undefined"!=typeof Stats&&(n=new Stats,n.setMode(0),n.domElement.style.position="absolute",n.domElement.style.left="0px",n.domElement.style.top="0px",$("body").append(n.domElement)),n}(),o=function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},r=1/60,i=0,a=o(),c=0;return+function u(){for(requestAnimationFrame(u),e.begin(),t=o(),i+=Math.min(1,(t-a)/1e3);i>r;)i-=r,$(n).trigger("loop.update",[c,r]),c+=1;$(n).trigger("loop.render",i),a=t,e.end()}(),n={reset:function(){c=0}}}()},{}],5:[function(n,t,e){t.exports=function(){"use strict";var n,t,e=function(){var n=$("<div/>").css({position:"fixed",backgroundColor:"black",height:"100%",width:"100%",margin:0,padding:0});return $("body").append(n),n}(),o=function(){var t=$("<button>").css({position:"fixed",bottom:"-100px",left:"50%"}).click(function(){$(n).trigger("title.playbutton.click")}).text("Play");return $("body").append(t),t}(),r=function(t,e){e.select&&$(n).trigger("title.playbutton.click")};return n={fadeFromBlack:function(){e.css({opacity:1}),e.stop().animate({opacity:0},600)},showTitle:function(n){o.stop().animate({bottom:"100px"},600,"easeOutBack"),t=n,$(t).on("input.move",r)},hideTitle:function(){o.stop().animate({bottom:"-100px"},400,"easeInBack"),$(t).off("input.move",r)}}}()},{}],6:[function(n,t,e){var o=n("./plane"),r=function(){return{position:new THREE.Vector3,momentum:new THREE.Vector3,orientation:new THREE.Quaternion,angularMomentum:new THREE.Vector3,velocity:new THREE.Vector3,angularVelocity:new THREE.Vector3,spin:new THREE.Quaternion,bodyToWorld:new THREE.Matrix4,inertiaTensor:1/6,inverseInertiaTensor:6}},i=function(){return{velocity:new THREE.Vector3,force:new THREE.Vector3,spin:new THREE.Quaternion,torque:new THREE.Vector3}},a=function(){var n=function(){var n,t,e=1e3,o=new THREE.Vector3,r=o.clone(),i=o.clone(),a=o.clone();return function(c,u,s,l,f){var p=f.constant-l.dot(f.normal);p>0&&(r.copy(c.angularVelocity),i.set(l.x,l.y,0).sub(c.position),r.cross(i).add(c.momentum),n=-f.normal.dot(r),t=a.copy(f.normal).multiplyScalar(p*e),u.add(t),s.add(o.copy(l).sub(c.position).cross(t)))}}(),t=new THREE.Vector3,e=t.clone(),r=t.clone(),i=t.clone();return function(a,c,u,s,l){var f=l.nearestPoint(s);e.set(s.x-f.x,s.y-f.y,0),e.length()<s.r&&(t.copy(e).normalize(),r.copy(t).multiplyScalar(s.r),i.copy(s).sub(r),n(a,c,u,i,o(t,f)))}}();t.exports=function(){"use strict";var n=r(),t=function(){n.velocity.copy(n.momentum),n.angularVelocity.copy(n.angularMomentum).multiplyScalar(n.inverseInertiaTensor),n.orientation.normalize(),n.spin.set(.5*n.angularVelocity.x,.5*n.angularVelocity.y,.5*n.angularVelocity.z,0),n.spin.multiply(n.orientation),n.bodyToWorld.makeTranslation(n.position.x,n.position.y,0),n.bodyToWorld.makeRotationFromQuaternion(n.orientation)},e=function(n,t,e){n.x+=t.x*e,n.y+=t.y*e,n.z+=t.z*e,"undefined"!=typeof n.w&&(n.w+=t.w*e)},o=function(n,t,e,o,r,i){var a=1/6;n.x+=a*i*(t.x+2*(e.x+o.x)+r.x),n.y+=a*i*(t.y+2*(e.y+o.y)+r.y),n.z+=a*i*(t.z+2*(e.z+o.z)+r.z),"undefined"!=typeof n.w&&(n.w+=a*i*(t.w+2*(e.w+o.w)+r.w))},c=function(){var t=new THREE.Vector3;return function(e,o,r,i,c){_.each(c,function(c){_.each(i,function(i){t.copy(i).transformDirection(n.bodyToWorld).multiply(i).add(n.position),t.r=i.r,a(e,o,r,t,c)})})}}(),u=function(n,t,e,o,r){t.set(0,0,0),e.set(0,0,0),f.forces(n,t,e),c(n,t,e,o,r),f.control(n,t,e)},s=function(n,o,r,a,c){var s=i();return"undefined"!=typeof a&&(e(n.position,a.velocity,c),e(n.momentum,a.force,c),e(n.orientation,a.spin,c),e(n.angularMomentum,a.torque,c),t()),s.velocity.copy(n.velocity),s.spin.copy(n.spin),u(n,s.force,s.torque,o,r),s},l=function(n,e,r,i){var a=s(e,r,i),c=s(e,r,i,a,.5*n),u=s(e,r,i,c,.5*n),l=s(e,r,i,u,n);o(e.position,a.velocity,c.velocity,u.velocity,l.velocity,n),o(e.momentum,a.force,c.force,u.force,l.force,n),o(e.orientation,a.spin,c.spin,u.spin,l.spin,n),o(e.angularMomentum,a.torque,c.torque,u.torque,l.torque,n),f.limitMomentum(e),t()},f={update:function(t,e,o){l(t,n,e,o)},forces:function(n,t,e){},control:function(n,t,e){},limitMomentum:function(n){},setPosition:function(t,e){n.position.set(t,e,0)},get x(){return n.position.x},get y(){return n.position.y},orientation:function(){var t=new THREE.Quaternion;return function(){return t.copy(n.orientation)}}()};return f}},{"./plane":9}],7:[function(n,t,e){var o=[];o.push([[],[{a:[2,2],b:[3,2]}],[{a:[1,2],b:[2,2]}],[{a:[1,2],b:[3,2]}],[{a:[0,2],b:[1,2]}],[{a:[0,2],b:[1,2]},{a:[2,2],b:[3,2]}],[{a:[0,2],b:[2,2]}],[{a:[0,2],b:[3,2]}]]),o.push([[],[{a:[1,0],b:[2,0]}],[{a:[0,0],b:[1,0]}],[{a:[0,0],b:[2,0]}],[{a:[-1,0],b:[0,0]}],[{a:[-1,0],b:[0,0]},{a:[1,0],b:[2,0]}],[{a:[-1,0],b:[1,0]}],[{a:[-1,0],b:[2,0]}]]),o.push([[],[{a:[1,0],b:[1,1]}],[{a:[1,1],b:[1,2]}],[{a:[1,1],b:[1,3]}],[{a:[1,0],b:[1,1]}],[{a:[1,0],b:[1,1]},{a:[1,2],b:[1,3]}],[{a:[1,0],b:[1,2]}],[{a:[1,0],b:[1,3]}]]),o.push([[],[{a:[2,0],b:[2,1]}],[{a:[2,1],b:[2,2]}],[{a:[2,1],b:[2,3]}],[{a:[2,0],b:[2,1]}],[{a:[2,0],b:[2,1]},{a:[2,2],b:[2,3]}],[{a:[2,0],b:[2,2]}],[{a:[2,0],b:[2,3]}]]),t.exports={createLine:function(n){var t={x:n.a[0],y:n.a[1],z:0},e={x:n.b[0],y:n.b[1],z:0},o=function(){var n=new THREE.Vector3;return n.subVectors(e,t)}(),r=function(){return o.lengthSq()}();return{p1:t,p2:e,nearestPoint:function(){var n=new THREE.Vector3,i=n.clone();return function(a){var c=n.subVectors(i.copy(a),t).dot(o);return 0>c?t:c>r?e:n.copy(o).multiplyScalar(c/r).add(t)}}()}},makeLines:function(n,t){switch(t){case"top":return o[0][n];case"bottom":return o[1][n];case"left":return o[2][n];case"right":return o[3][n]}return[]}}},{}],8:[function(n,t,e){var o=n("./line");t.exports=function(){"use strict";var n=[],t={tw:64,th:48},e=function(e,o){return n[e+o*t.tw]};return{clear:function(){n=[]},getLines:function(n){var t=Math.floor(n.x),r=Math.floor(n.y),i=0;i+=e(t-1,r-1)?4:0,i+=e(t,r-1)?2:0,i+=e(t+1,r-1)?1:0;var a=o.makeLines(i,"bottom"),c=[];return _.each(a,function(n){c.push(o.createLine({a:[t+n.a[0],r+n.a[1]],b:[t+n.b[0],r+n.b[1]]}))}),c},getCell:function(n,t){return e(n,t)},addBlocks:function(t){n=t}}}},{"./line":7}],9:[function(n,t,e){t.exports=function(n,t){return{normal:n,constant:n.dot(t)}}},{}],10:[function(n,t,e){"use strict";var o=new THREE.Matrix3,r=new THREE.Vector3,i=function(n){var t=n.x+n.x,e=n.y+n.y,r=n.z+n.z,i=t*n.w,a=e*n.w,c=r*n.w,u=t*n.x,s=e*n.x,l=r*n.x,f=e*n.y,p=r*n.y,d=r*n.z;return o.set(1-(f+d),s-c,0,s+c,1-(u+d),0,l-a,p+i,0)};t.exports=function(n,t,e){r.copy(e),r.applyMatrix3(i(t)),n.x+=r.x,n.y+=r.y}},{}],11:[function(n,t,e){var o=1,r=.8,i=.4,a=new THREE.Vector3(0,5,0),c=[{x:0,y:.175,z:0,r:.25},{x:0,y:-.175,z:0,r:.25}];t.exports=function(t){"use strict";var e=n("./physics/entity")(),u=n("./physics/thrust"),s=!1,l=!1,f=!1;e.forces=function(n,t,e){var o=n.angularVelocity;u(t,n.orientation,a),e.x-=o.x*i,e.y-=o.y*i,e.z-=o.z*i},e.control=function(n,t,e){s&&(e.z+=r),l&&(e.z-=r)},e.limitMomentum=function(n){var t=n.momentum;t.length()>o&&(t.normalize(),t.multiplyScalar(o))};var p=function(n,t){s=t.left,l=t.right,f=t.jump};return $(t.input).on("input.move",p),{get x(){return e.x},get y(){return e.y},get orientation(){return e.orientation},detatchInput:function(){$(t.input).off("input.move",p)},reset:function(){f=s=l=!1,e.setPosition(t.pos.x,t.pos.y)},update:function(n,o,r){t.input.update(n),e.update(o,c,r)}}}},{"./physics/entity":6,"./physics/thrust":10}],12:[function(n,t,e){var o=26;t.exports=function(n){"use strict";var t,e=new THREE.Scene,r=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,o-9,o),i=new THREE.AmbientLight(16777215),a=new THREE.WebGLRenderer;return r.position.set(0,0,o),r.updateProjectionMatrix(),e.add(r),e.add(i),a.setSize(window.innerWidth,window.innerHeight),a.setClearColor(4079166,1),$("body").append(a.domElement),t={render:function(){a.render(e,r)},add:function(n){e.add(n)},follow:function(n){r.position.set(n.x,n.y,o)},remove:function(n){e.remove(n)},clear:function(){var n=_.clone(e.children);_.each(n,function(n){e.remove(n)})}}}},{}],13:[function(n,t,e){t.exports=function(){"use strict";var t,e=n("./assets"),o=n("./scene"),r=n("./physics/map"),i=[],a=[],c=r(),u={tw:64,th:48},s=o($("#canvas"));return{update:function(n,t){_.each(i,function(e){e.update(n,t,c.getLines(e))})},render:function(n){_.each(i,function(n){n.avatar.setRotationFromQuaternion(n.orientation()),n.avatar.position.set(n.x,n.y,0)}),t&&s.follow(t.position),s.render()},clear:function(){i=[],a=[],c.clear(),s.clear()},addTarget:function(n){var t=e.cubeTarget();a.push(n),n.avatar=t,t.position.set(n.x,n.y,0),s.add(t)},addPlayer:function(n,o){i.push(n),n.avatar=e.cubePlayer(),s.add(n.avatar),o&&(t=n.avatar)},addBlocks:function(n){c.addBlocks(n);var t,o,r,i;for(o=u.th-1;o>=0;o--)for(t=0;t<u.tw;t++)r=c.getCell(t,o),i=1===r?e.cubeSolid():e.cubeEmpty(),i.position.set(t,o,0),s.add(i)},isComplete:function(){return a.length<=0}}}()},{"./assets":2,"./physics/map":8,"./scene":12}]},{},[1]);